- require 'csv'

- content = CSV.generate do |csv|
  - csv << ["Prefix", "First Name", "Middle Name", "Last Name", "Primary Email", "Job Title", "Company" ,"Address", "Address 2", "City", "State", "Zip", "Country", "Birthday", "Do Not Email", "Do Not Mail", "Send cookies", "Send MMI ballgame emails", "Contest participant", "Source", "Primary Phone", "Notes"]
  - @contacts.each do |contact|
    - address = contact.addresses.first || Address.new
    - phone_number = contact.phone_numbers.first || PhoneNumber.new
    - notes = contact.notes.present? ? contact.notes.map(&:note).join(".") : "None"
    - csv << [contact.prefix, contact.first_name, contact.middle_name, contact.last_name, contact.emails.first, contact.job_title, contact.company.name, address.address_line_1, address.address_line_2, address.city, address.state, address.zip, address.country.upcase, contact.birthday, human_boolean(contact.do_not_email), human_boolean(contact.do_not_mail), human_boolean(contact.send_cookies), human_boolean(contact.mmi_ballgame), human_boolean(contact.contest_participant), contact.source, phone_number, notes]

= raw content